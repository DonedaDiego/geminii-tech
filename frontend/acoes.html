<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>A√ß√µes - Geminii Tecnologia</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            dark: '#000000',
            light: '#ffffff',
            subtle: 'rgba(255,255,255,0.1)',
            geminii: '#ba39af'
          },
          fontFamily: {
            sans: ['Inter', 'sans-serif']
          }
        }
      }
    }
  </script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    /* Reutilizar estilos do home.html */
    .neon-text {
      color: #ba39af;
      text-shadow: 
        0 0 2px #ba39af,
        0 0 4px #ba39af,
        0 0 6px #ba39af,
        0 0 8px #ba39af;
    }

    .neon-logo {
      transition: all 0.3s ease;
    }
    
    .neon-logo:hover {
      filter: 
        drop-shadow(0 0 5px #ba39af)
        drop-shadow(0 0 10px #ba39af)
        brightness(1.2);
      transform: scale(1.1);
    }

    nav:hover {
      background: rgba(186, 57, 175, 0.05);
      border-color: rgba(186, 57, 175, 0.3);
      box-shadow: 
        0 25px 50px -12px rgba(0, 0, 0, 0.25),
        0 0 20px rgba(186, 57, 175, 0.2);
      transition: all 0.3s ease;
    }

    nav a:hover {
      color: #ba39af;
      text-shadow: 
        0 0 5px #ba39af,
        0 0 10px #ba39af;
      transition: all 0.3s ease;
    }

    /* Stock Cards */
    .stock-card {
      background: rgba(255, 255, 255, 0.03);
      border: 1px solid rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(10px);
      transition: all 0.3s ease;
    }

    .stock-card:hover {
      background: rgba(255, 255, 255, 0.08);
      border-color: rgba(186, 57, 175, 0.3);
      box-shadow: 
        0 10px 25px -5px rgba(0, 0, 0, 0.3),
        0 0 20px rgba(186, 57, 175, 0.1);
      transform: translateY(-2px);
    }

    .positive {
      color: #10b981;
    }

    .negative {
      color: #ef4444;
    }

    .loading-card {
      background: rgba(255, 255, 255, 0.05);
      border: 1px solid rgba(255, 255, 255, 0.1);
      animation: pulse 2s infinite;
    }

    .search-input {
      background: rgba(255, 255, 255, 0.05);
      border: 1px solid rgba(255, 255, 255, 0.2);
      backdrop-filter: blur(10px);
    }

    .search-input:focus {
      border-color: #ba39af;
      box-shadow: 0 0 10px rgba(186, 57, 175, 0.3);
    }

    /* Market Summary */
    .market-card {
      background: rgba(255, 255, 255, 0.05);
      border: 1px solid rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(10px);
    }

    .spinner {
      border: 2px solid rgba(255, 255, 255, 0.1);
      border-radius: 50%;
      border-top: 2px solid #ba39af;
      width: 20px;
      height: 20px;
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }
  </style>
</head>
<body class="bg-black text-white font-sans min-h-screen">
  <!-- Glass floating navbar -->
  <nav class="fixed top-6 left-1/2 transform -translate-x-1/2 z-50 bg-opacity-5 border-opacity-10 bg-white border-white border rounded-full pt-3 pr-4 pb-3 pl-4 shadow-xl backdrop-blur-md">
    <div class="flex items-center justify-between">
      <div class="flex items-center">
        <img src="https://app.geminii.com.br/wp-content/uploads/2025/06/logo.png" alt="Geminii Logo" class="w-6 h-6 neon-logo">
      </div>
      <div class="hidden md:flex items-center space-x-6 text-xs text-gray-300 ml-8">
        <a href="/" class="hover:text-white transition-colors">Home</a>
        <a href="#" class="hover:text-white transition-colors">Op√ß√µes</a>
        <a href="/acoes" class="text-geminii">A√ß√µes</a>
        <a href="#" class="hover:text-white transition-colors">An√°lises</a>
        <a href="#" class="hover:text-white transition-colors">Contato</a>
      </div>
      <div class="flex items-center space-x-3 ml-8">
        <div id="apiStatus" class="w-8 h-8 bg-green-500 bg-opacity-10 border border-green-500 border-opacity-30 rounded-full flex items-center justify-center relative">
          <i class="fas fa-shield-alt text-green-500 text-xs"></i>
          <div class="absolute -top-1 -right-1 w-2 h-2 bg-green-500 rounded-full animate-pulse"></div>
        </div>
        <a href="#" class="hidden md:inline-block text-xs font-medium hover:text-white transition-colors">Login</a>
        <a href="#" class="hover:bg-gray-200 transition-colors text-xs font-medium text-black bg-white rounded-full pt-1.5 pr-3 pb-1.5 pl-3">Come√ßar</a>
      </div>
    </div>
  </nav>

  <div class="pt-28 px-6">
    <!-- Header -->
    <div class="max-w-7xl mx-auto mb-12">
      <h1 class="text-4xl md:text-5xl font-bold neon-text mb-4">
        A√ß√µes Brasileiras
      </h1>
      <p class="text-xl text-gray-300 max-w-2xl">
        Acompanhe em tempo real os pre√ßos, varia√ß√µes e dados fundamentais das principais a√ß√µes da B3.
      </p>
    </div>

    <!-- Market Summary -->
    <div class="max-w-7xl mx-auto mb-12">
      <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
        <!-- Ibovespa -->
        <div class="market-card rounded-xl p-6">
          <div class="flex items-center justify-between">
            <div>
              <h3 class="text-sm text-gray-400 mb-1">IBOVESPA</h3>
              <p id="ibovValue" class="text-2xl font-bold">---</p>
            </div>
            <div class="text-right">
              <p id="ibovChange" class="text-sm">---</p>
              <p id="ibovPercent" class="text-xs text-gray-400">---</p>
            </div>
          </div>
        </div>

        <!-- D√≥lar -->
        <div class="market-card rounded-xl p-6">
          <div class="flex items-center justify-between">
            <div>
              <h3 class="text-sm text-gray-400 mb-1">USD/BRL</h3>
              <p id="dolarValue" class="text-2xl font-bold">---</p>
            </div>
            <div class="text-right">
              <p id="dolarChange" class="text-sm">---</p>
              <p id="dolarPercent" class="text-xs text-gray-400">---</p>
            </div>
          </div>
        </div>

        <!-- Status -->
        <div class="market-card rounded-xl p-6">
          <div class="flex items-center justify-between">
            <div>
              <h3 class="text-sm text-gray-400 mb-1">Status do Mercado</h3>
              <p class="text-2xl font-bold text-green-400">ABERTO</p>
            </div>
            <div class="text-right">
              <p id="lastUpdate" class="text-xs text-gray-400">Atualizando...</p>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Search and Filters -->
    <div class="max-w-7xl mx-auto mb-8">
      <div class="flex flex-col md:flex-row gap-4">
        <div class="flex-1">
          <input 
            type="text" 
            id="searchInput"
            placeholder="Buscar a√ß√£o (ex: PETR4, Petrobras...)" 
            class="search-input w-full px-4 py-3 rounded-full text-white placeholder-gray-400 focus:outline-none transition-all duration-300"
          >
        </div>
        <button id="refreshBtn" class="px-6 py-3 bg-geminii text-white rounded-full hover:bg-opacity-80 transition-all duration-300">
          <i class="fas fa-sync-alt mr-2"></i>
          Atualizar
        </button>
      </div>
    </div>

    <!-- Stocks Grid -->
    <div class="max-w-7xl mx-auto">
      <div id="stocksGrid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6 mb-12">
        <!-- Loading cards -->
        <div class="loading-card rounded-xl p-6">
          <div class="animate-pulse">
            <div class="h-4 bg-gray-600 rounded w-3/4 mb-2"></div>
            <div class="h-6 bg-gray-600 rounded w-1/2 mb-3"></div>
            <div class="h-3 bg-gray-600 rounded w-1/4"></div>
          </div>
        </div>
        <div class="loading-card rounded-xl p-6">
          <div class="animate-pulse">
            <div class="h-4 bg-gray-600 rounded w-3/4 mb-2"></div>
            <div class="h-6 bg-gray-600 rounded w-1/2 mb-3"></div>
            <div class="h-3 bg-gray-600 rounded w-1/4"></div>
          </div>
        </div>
        <div class="loading-card rounded-xl p-6">
          <div class="animate-pulse">
            <div class="h-4 bg-gray-600 rounded w-3/4 mb-2"></div>
            <div class="h-6 bg-gray-600 rounded w-1/2 mb-3"></div>
            <div class="h-3 bg-gray-600 rounded w-1/4"></div>
          </div>
        </div>
        <div class="loading-card rounded-xl p-6">
          <div class="animate-pulse">
            <div class="h-4 bg-gray-600 rounded w-3/4 mb-2"></div>
            <div class="h-6 bg-gray-600 rounded w-1/2 mb-3"></div>
            <div class="h-3 bg-gray-600 rounded w-1/4"></div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    // API Configuration
    const API_BASE_URL = 'http://localhost:5000/api';
    let allStocks = [];
    let isLoading = false;

    // Utility function for API calls
    async function apiCall(endpoint, options = {}) {
      try {
        const response = await fetch(`${API_BASE_URL}${endpoint}`, {
          ...options,
          headers: {
            'Content-Type': 'application/json',
            ...options.headers,
          },
        });
        
        if (!response.ok) {
          throw new Error(`HTTP error! status: ${response.status}`);
        }
        
        return await response.json();
      } catch (error) {
        console.error('API Error:', error);
        throw error;
      }
    }

    // Format currency
    function formatCurrency(value) {
      return new Intl.NumberFormat('pt-BR', {
        style: 'currency',
        currency: 'BRL'
      }).format(value);
    }

    // Format percentage
    function formatPercent(value) {
      const sign = value >= 0 ? '+' : '';
      return `${sign}${value.toFixed(2)}%`;
    }

    // Create stock card HTML
    function createStockCard(stock) {
      const changeClass = stock.change >= 0 ? 'positive' : 'negative';
      const changeIcon = stock.change >= 0 ? 'fa-arrow-up' : 'fa-arrow-down';
      
      return `
        <div class="stock-card rounded-xl p-6 cursor-pointer" onclick="showStockDetails('${stock.symbol}')">
          <div class="flex items-start justify-between mb-4">
            <div>
              <h3 class="text-lg font-bold text-white">${stock.symbol}</h3>
              <p class="text-sm text-gray-400 truncate">${stock.name}</p>
            </div>
            <div class="text-right">
              <p class="text-xl font-bold">${formatCurrency(stock.current_price)}</p>
            </div>
          </div>
          
          <div class="flex items-center justify-between">
            <div class="flex items-center space-x-2">
              <i class="fas ${changeIcon} text-xs ${changeClass}"></i>
              <span class="text-sm ${changeClass}">${formatCurrency(Math.abs(stock.change))}</span>
            </div>
            <span class="text-sm ${changeClass}">${formatPercent(stock.change_percent)}</span>
          </div>
          
          <div class="mt-4 text-xs text-gray-500">
            <div class="flex justify-between">
              <span>Volume:</span>
              <span>${stock.volume.toLocaleString('pt-BR')}</span>
            </div>
            <div class="flex justify-between">
              <span>Setor:</span>
              <span class="truncate ml-2">${stock.sector}</span>
            </div>
          </div>
        </div>
      `;
    }

    // Load market data
    async function loadMarketData() {
      try {
        const data = await apiCall('/market-data');
        
        // Update Ibovespa
        document.getElementById('ibovValue').textContent = data.ibovespa.value.toLocaleString('pt-BR');
        document.getElementById('ibovChange').textContent = formatCurrency(data.ibovespa.change);
        document.getElementById('ibovPercent').textContent = formatPercent(data.ibovespa.change_percent);
        document.getElementById('ibovChange').className = `text-sm ${data.ibovespa.change >= 0 ? 'positive' : 'negative'}`;
        
        // Update D√≥lar
        document.getElementById('dolarValue').textContent = `R$ ${data.dolar.value.toFixed(2)}`;
        document.getElementById('dolarChange').textContent = `R$ ${data.dolar.change.toFixed(4)}`;
        ddocument.getElementById('dolarPercent').textContent = formatPercent(data.dolar.change_percent);
        document.getElementById('dolarChange').className = `text-sm ${data.dolar.change >= 0 ? 'positive' : 'negative'}`;
        
        // Update timestamp
        const now = new Date().toLocaleTimeString('pt-BR');
        document.getElementById('lastUpdate').textContent = `Atualizado √†s ${now}`;
        
      } catch (error) {
        console.error('Erro ao carregar dados do mercado:', error);
      }
    }

    // Load stocks data
    async function loadStocks() {
      if (isLoading) return;
      
      isLoading = true;
      const refreshBtn = document.getElementById('refreshBtn');
      refreshBtn.innerHTML = '<div class="spinner"></div> Carregando...';
      
      try {
        const data = await apiCall('/stocks');
        allStocks = data.stocks;
        displayStocks(allStocks);
        
      } catch (error) {
        console.error('Erro ao carregar a√ß√µes:', error);
        document.getElementById('stocksGrid').innerHTML = `
          <div class="col-span-full text-center py-12">
            <i class="fas fa-exclamation-triangle text-4xl text-yellow-500 mb-4"></i>
            <p class="text-xl text-gray-300">Erro ao carregar dados das a√ß√µes</p>
            <p class="text-sm text-gray-500">Verifique sua conex√£o e tente novamente</p>
          </div>
        `;
      } finally {
        isLoading = false;
        refreshBtn.innerHTML = '<i class="fas fa-sync-alt mr-2"></i> Atualizar';
      }
    }

    // Display stocks in grid
    function displayStocks(stocks) {
      const grid = document.getElementById('stocksGrid');
      
      if (stocks.length === 0) {
        grid.innerHTML = `
          <div class="col-span-full text-center py-12">
            <i class="fas fa-search text-4xl text-gray-500 mb-4"></i>
            <p class="text-xl text-gray-300">Nenhuma a√ß√£o encontrada</p>
            <p class="text-sm text-gray-500">Tente ajustar sua busca</p>
          </div>
        `;
        return;
      }
      
      grid.innerHTML = stocks.map(stock => createStockCard(stock)).join('');
    }

    // Search functionality
    function filterStocks() {
      const searchTerm = document.getElementById('searchInput').value.toLowerCase();
      
      if (!searchTerm) {
        displayStocks(allStocks);
        return;
      }
      
      const filtered = allStocks.filter(stock => 
        stock.symbol.toLowerCase().includes(searchTerm) || 
        stock.name.toLowerCase().includes(searchTerm) ||
        stock.sector.toLowerCase().includes(searchTerm)
      );
      
      displayStocks(filtered);
    }

    // Show stock details (modal or alert for now)
    async function showStockDetails(symbol) {
      try {
        const data = await apiCall(`/stock/${symbol}`);
        const stock = data.stock;
        
        const details = `
üìä ${stock.symbol} - ${stock.name}

üí∞ Pre√ßo Atual: ${formatCurrency(stock.current_price)}
üìà Varia√ß√£o: ${formatCurrency(stock.change)} (${formatPercent(stock.change_percent)})
üìä Volume: ${stock.volume.toLocaleString('pt-BR')}
üè¢ Setor: ${stock.sector}

üìä M√°ximas e M√≠nimas (52 semanas):
- M√°xima: ${formatCurrency(stock.high_52w)}
- M√≠nima: ${formatCurrency(stock.low_52w)}

üìÖ √öltima atualiza√ß√£o: ${new Date(stock.last_update).toLocaleString('pt-BR')}
        `;
        
        alert(details);
        
      } catch (error) {
        alert('‚ùå Erro ao carregar detalhes da a√ß√£o');
        console.error('Stock details error:', error);
      }
    }

    // Initialize app
    function initApp() {
      console.log('üöÄ Inicializando p√°gina de A√ß√µes...');
      
      // Load initial data
      loadMarketData();
      loadStocks();
      
      // Auto-refresh market data every 30 seconds
      setInterval(loadMarketData, 30000);
      
      console.log('‚úÖ P√°gina de a√ß√µes carregada!');
    }

    // Event Listeners
    document.addEventListener('DOMContentLoaded', function() {
      initApp();

      // Search input
      const searchInput = document.getElementById('searchInput');
      searchInput.addEventListener('input', filterStocks);
      
      // Refresh button
      document.getElementById('refreshBtn').addEventListener('click', function() {
        loadMarketData();
        loadStocks();
      });

      // Navigation clicks
      document.querySelectorAll('nav a').forEach(link => {
        link.addEventListener('click', function(e) {
          if (this.getAttribute('href') === '#') {
            e.preventDefault();
            console.log('Navegando para:', this.textContent);
          }
        });
      });
    });

    // Expose functions for console testing
    window.acoesAPI = {
      loadMarketData,
      loadStocks,
      showStockDetails,
      filterStocks
    };

    console.log('üí° Fun√ß√µes dispon√≠veis: acoesAPI.showStockDetails("PETR4")');
  </script>
</body>
</html>